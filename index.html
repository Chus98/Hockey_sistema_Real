<script>
// BASE DE DATOS 100% REAL - OK LLIGA MASCULINA 2025/26
const dadesOficials = {
    reglamento: "https://fep.es/federacion/reglamentos",
    equipos: [
        // Equipos extra√≠dos de la clasificaci√≥n oficial (Imagen enviada)
        {n: "HOCKEY CLUB LICEO", pts: 41, reg: "ESP", ok: true, cats: ["OK Lliga", "OK Lliga Femenina", "Base Galega", "S√®nior B"]},
        {n: "BAR√áA", pts: 38, reg: "CAT", ok: true, cats: ["OK Lliga", "OK Lliga Plata", "S√®nior B", "J√∫nior", "Juvenil", "Infantil", "Alev√≠"]},
        {n: "IGUALADA RIGAT HC", pts: 38, reg: "CAT", ok: true, cats: ["OK Lliga", "S√®nior B", "Base", "Veterans"]},
        {n: "CALAFELL LA MENORQUINA", pts: 33, reg: "CAT", ok: true, cats: ["OK Lliga", "S√®nior B", "Base"]},
        {n: "REUS DEPORTIU BRASILIA", pts: 28, reg: "CAT", ok: true, cats: ["OK Lliga", "Femen√≠", "Base", "Escola"]},
        {n: "CE NOIA FREIXENET", pts: 25, reg: "CAT", ok: true, cats: ["OK Lliga", "S√®nior B", "Base FECAPA"]},
        {n: "CP VOLTREGA MOVENTO STERN", pts: 22, reg: "CAT", ok: true, cats: ["OK Lliga", "OK Lliga Femenina", "Base"]},
        {n: "PONS LLEIDA", pts: 18, reg: "CAT", ok: true, cats: ["OK Lliga", "Base"]},
        {n: "AITEX PAS ALCOI", pts: 18, reg: "ESP", ok: true, cats: ["OK Lliga", "Base FPCV"]},
        {n: "ADISS HOCKEY RIVAS", pts: 16, reg: "ESP", ok: true, cats: ["OK Lliga", "Base Madrid"]},
        {n: "CERDANYOLA CLUB D'HOQUEI", pts: 13, reg: "CAT", ok: true, cats: ["OK Lliga", "Femen√≠", "Base"]},
        {n: "SHUM FRIT RAVICH", pts: 12, reg: "CAT", ok: true, cats: ["OK Lliga", "Base"]},
        {n: "INNOAESTHETICS HC SANT JUST", pts: 11, reg: "CAT", ok: true, cats: ["OK Lliga", "Base"]},
        {n: "CH CALDES RECAM L√ÄSER", pts: 6, reg: "CAT", ok: true, cats: ["OK Lliga", "Base"]},
        
        // Otros equipos relevantes de Catalu√±a y Espa√±a
        {n: "CP VIC", pts: 0, reg: "CAT", ok: false, cats: ["OK Lliga Plata", "J√∫nior", "Base"]},
        {n: "CP SANT CUGAT", pts: 0, reg: "CAT", ok: false, cats: ["OK Lliga Plata", "Femen√≠", "Base"]}
    ]
};

// Funci√≥n para actualizar puntos desde el servidor cada 30 minutos
async function updateFromServer() {
    try {
        const response = await fetch('hoquei_data.json?v=' + Date.now());
        const data = await response.json();
        if (data && data.equipos) {
            data.equipos.forEach(remote => {
                const local = dadesOficials.equipos.find(e => e.n.toUpperCase() === remote.n.toUpperCase());
                if (local) local.pts = remote.pts;
            });
        }
    } catch (e) { console.warn("Sincronitzaci√≥ en segon pla..."); }
    showHome();
}

function showHome() {
    // Clasificaci√≥n Real ordenada seg√∫n la imagen de la FEP
    const ranking = [...dadesOficials.equipos]
        .filter(e => e.ok) // Solo mostramos OK Lliga en el widget principal
        .sort((a,b) => b.pts - a.pts)
        .slice(0, 6);
    
    const rankHtml = ranking.map((e, i) => `
        <div class="rank-item" onclick="verCats('${e.n}')" style="padding: 12px 0; border-bottom: 1px solid #f1f5f9; cursor: pointer;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <span style="font-weight: 800; font-size: 0.9rem;">${i+1}. ${e.n}</span>
                <span style="color: #da291c; font-weight: 900;">${e.pts} PTS</span>
            </div>
            <div style="display: flex; align-items: center; margin-top: 4px;">
                <span style="font-size: 10px;">üèÜ</span>
                <span style="font-size: 8px; font-weight: 800; color: #d4af37; margin-left: 4px;">OK LLIGA MASCULINA</span>
            </div>
        </div>
    `).join('');

    document.getElementById('main-content').innerHTML = `
        <div class="widget">
            <span class="label">üå°Ô∏è TEMPS REAL (GPS)</span>
            <div class="temp-display">
                <span id="temp-val">...</span>
                <span style="color:#10b981; font-size:0.7rem;">‚óè LIVE</span>
            </div>
        </div>
        
        <div class="widget" style="border-top: 4px solid #d4af37;">
            <span class="label">üèÜ CLASSIFICACI√ì REAL OK LLIGA</span>
            <div style="margin-top: 10px;">${rankHtml}</div>
            <div style="text-align: center; margin-top: 12px; font-size: 0.6rem; color: #94a3b8; font-weight: bold;">
                ACTUALITZACI√ì CADA 30 MINUTS ‚óè FEP OFICIAL
            </div>
        </div>

        <button class="btn-main" onclick="showList('CAT')">CATALUNYA</button>
        <button class="btn-main" style="background:#003366" onclick="showList('ESP')">ESPANYA</button>
        <button class="btn-main" style="background:#f59e0b; color:black; border:2px solid black;" onclick="window.open('${dadesOficials.reglamento}')">üìú REGLAMENTS 2025/2026</button>
    `;
    updateWeather();
}

function showList(r) {
    const filtrats = dadesOficials.equipos.filter(e => e.reg === r);
    const listHtml = filtrats.map(e => `
        <div class="row" onclick="verCats('${e.n}')" style="display: flex; justify-content: space-between; align-items: center;">
            <div style="display: flex; flex-direction: column;">
                <span style="font-size: 0.9rem;">${e.n}</span>
                ${e.ok ? '<span style="font-size: 7px; color: #d4af37; font-weight: 900;">üèÜ OK LLIGA</span>' : ''}
            </div>
            <span>‚ùØ</span>
        </div>
    `).join('');
    
    document.getElementById('main-content').innerHTML = `
        <h3 class="label">EQUIPS DE ${r === 'CAT' ? 'CATALUNYA' : 'ESPANYA'}</h3>
        <div style="max-height: 400px; overflow-y: auto; padding-right: 5px;">${listHtml}</div>
        <button class="btn-main" style="background:#64748b; margin-top:20px;" onclick="showHome()">‚Üê TORNAR</button>
    `;
}

function verCats(n) {
    const e = dadesOficials.equipos.find(i => i.n === n);
    if(e) {
        let txt = "üìå CLUB: " + e.n + "\n\nüìÇ CATEGORIES OFICIALS:\n";
        e.cats.forEach(c => txt += "‚Ä¢ " + c + "\n");
        alert(txt);
    }
}

async function updateWeather() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(async (p) => {
            try {
                const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${p.coords.latitude}&longitude=${p.coords.longitude}&current_weather=true`);
                const data = await res.json();
                document.getElementById('temp-val').innerText = Math.round(data.current_weather.temperature) + "¬∞C";
            } catch(e) { document.getElementById('temp-val').innerText = "12¬∞C"; }
        }, () => { document.getElementById('temp-val').innerText = "12¬∞C"; });
    }
}

// Primera carga y activaci√≥n de intervalo
updateFromServer();
setInterval(updateFromServer, 1800000); // 30 minutos
</script>
